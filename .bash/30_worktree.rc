# for git worktree management

# Git worktree directory change function
gwcd() {
  if [[ $# -eq 0 ]]; then
    # Interactive mode
    local target_path=$(git wcd-path)
    if [[ -n "$target_path" ]]; then
      cd "$target_path"
      echo "Changed to worktree: $(basename "$target_path")"
    fi
  else
    # Direct specification
    local target_path=$(git wcd-path "$1")
    if [[ -n "$target_path" ]]; then
      cd "$target_path"
      echo "Changed to worktree: $1"
    fi
  fi
}

alias cw='gwcd'

wl() {
  gwq list
}

# cd to worktree (created by phantom) directory
phantom-cw () {
  local target_dir=$(phantom where --fzf)
  if [ -n "$target_dir" ]; then
    cd "$target_dir"
  else
    echo "No worktree selected or found."
  fi
}

# Change Directory to the root of the current git worktree repository
cwr () {
  # worktree の先頭、が多分 root
  local worktree=$(git worktree list | head -n 1 | awk '{print $1}')

  if [ -n "$worktree" ]; then
    cd "$worktree"
    echo "Changed ${PWD}"
  else
    echo "No worktree found."
  fi
}

# Show root git dir
wr() {
  dirname $(git rev-parse --git-common-dir)
}
